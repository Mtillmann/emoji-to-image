!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).EMOJI=t.EMOJI||{})}(this,(function(t){"use strict";t.BaseRenderer=class{measureCanvas;measureContext;canvasCache={};measureCache={};options={targetWidth:600,bgcolor:!1,color:null,font:"sans-serif",alphaThreshold:0};constructor(t={}){this.options={...this.options,...t},this.measureCanvas=document.createElement("canvas"),this.measureContext=this.measureCanvas.getContext("2d")}measureCanvasContextContent(t,e,i=0){let a,s={left:!1,top:!1,right:!1,bottom:!1},n=parseInt(t.canvas.getAttribute("width"),10),o=parseInt(t.canvas.getAttribute("height"),10);const r=navigator.brave?1:0,h=(t,e)=>(e+1)%4==0?t>i:t>r;for(a=0;a<.5*n&&(!s.left||!s.right);a++){if(!s.left){t.getImageData(a,0,1,o).data.filter(h).length>0&&(s.left=Math.max(0,a-1))}if(!s.right){t.getImageData(n-a,0,1,o).data.filter(h).length>0&&(s.right=Math.min(n,a-1))}}for(a=0;a<.5*o&&(!s.top||!s.bottom);a++){if(!s.top){t.getImageData(0,a,n,1).data.filter(h).length>0&&(s.top=Math.max(0,a-1))}if(!s.bottom){t.getImageData(0,o-a,n,1).data.filter(h).length>0&&(s.bottom=Math.min(o,a-1))}}let l=o-s.top-s.bottom,c=n-s.right-s.left,u=e||c,m=l,f=u*m/(c*l);return e&&(u=e,m=l*f),{bounds:s,scaleFactor:f,dims:{width:u,height:m},actualDims:{width:c,height:l}}}measure(t){const e=this.normalize(t);if(e in this.measureCache)return this.measureCache[e];const i=100,a=150;this.measureCanvas.width=a,this.measureCanvas.height=a,this.measureContext.clearRect(0,0,a,a),this.measureContext.font="100px "+t.font,this.measureContext.textBaseline="middle",this.measureContext.textAlign="center",this.measureContext.fillText(t.emoji,75,75);let s=this.measureCanvasContextContent(this.measureContext,t.targetWidth,t.alphaThreshold),n=s.scaleFactor*i;return this.measureCache[e]={width:s.dims.width,height:s.dims.height,targetFontSize:n,yOffset:(75-.5*s.actualDims.height-s.bounds.top)/s.actualDims.height,xOffset:(75-.5*s.actualDims.width-s.bounds.left)/s.actualDims.width},this.measureCache[e]}render(t){t=this.normalizeInput(t);const e=this.normalize(t);if(e in this.canvasCache)return this.canvasCache[e];let i=document.createElement("canvas");const a=i.getContext("2d"),s=this.measure(t);i.setAttribute("width",s.width),i.setAttribute("height",s.height),a.clearRect(0,0,s.width,s.height),a.font=`${Math.round(s.targetFontSize)}px ${t.font}`,a.textAlign="center",a.textBaseline="middle";const n={x:.5*s.width+s.width*s.xOffset,y:.5*s.height+s.height*s.yOffset};return t.color&&(a.fillStyle=t.color),a.fillText(t.emoji,n.x,n.y),"BaseRenderer"===this.constructor.name&&(i=this.fillBackground(i,t.bgcolor)),this.canvasCache[e]=i,this.canvasCache[e]}fillBackground(t,e){if(!e||"transparent"===e||""===e)return t;const i=document.createElement("canvas"),a=i.getContext("2d"),s=t.getAttribute("width"),n=t.getAttribute("height");return i.setAttribute("width",s),i.setAttribute("height",n),a.beginPath(),a.fillStyle=e,a.fillRect(0,0,s,n),a.fill(),a.closePath(),a.drawImage(t,0,0),i}normalize(t){if((t=this.normalizeInput(t)).isError)return"PARSE_ERROR";let e=t.emoji+"_",i=[];for(const e in t)"emoji"!==e&&i.push([e,t[e]]);i.sort(((t,e)=>t[0]>e[0]?1:-1));for(const[t,a]of i){let t=String(a);[["true","t"],["false","f"],["null","n"],["sans-serif","ss"],["inside","is"],["outside","os"]].forEach((e=>t=t.replace(e[0],e[1])));for(let i=0;i<t.length;i++){const a=t.charCodeAt(i);e+=a>=48&&a<=57||a>=65&&a<=90||a>=61&&a<=122?t[i]:t.charCodeAt(i).toString(16)}}return e}normalizeInput(t){let e;if("object"==typeof t)e=t;else if("{"===t[0])try{e=JSON.parse(t)}catch(i){e={emoji:"�️",isBasicEmoji:!0,isError:!0},console.error("JSON PARSE failed on data-emoji='"+t+"'")}else e={isBasicEmoji:!0,emoji:t};e.targetWidth=e.targetWidth||this.options.targetWidth;for(const t in this.options)t in e||(e[t]=this.options[t]);return e}},Object.defineProperty(t,"__esModule",{value:!0})}));