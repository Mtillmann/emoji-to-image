!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).EMOJI=t.EMOJI||{})}(this,(function(t){"use strict";t.DecoratedRenderer=class extends class extends class{measureCanvas;measureContext;canvasCache={};measureCache={};options={targetWidth:600,bgcolor:!1,color:null,font:"sans-serif",fontSize:null,alphaThreshold:0};constructor(t={}){this.options={...this.options,...t},this.measureCanvas=document.createElement("canvas"),this.measureContext=this.measureCanvas.getContext("2d")}measureCanvasContextContent(t,e,i=0){let a,r={left:!1,top:!1,right:!1,bottom:!1},s=parseInt(t.canvas.getAttribute("width"),10),n=parseInt(t.canvas.getAttribute("height"),10);const o=navigator.brave?1:0,h=(t,e)=>(e+1)%4==0?t>i:t>o;for(a=0;a<.5*s&&(!r.left||!r.right);a++){if(!r.left){t.getImageData(a,0,1,n).data.filter(h).length>0&&(r.left=Math.max(0,a-1))}if(!r.right){t.getImageData(s-a,0,1,n).data.filter(h).length>0&&(r.right=Math.min(s,a-1))}}for(a=0;a<.5*n&&(!r.top||!r.bottom);a++){if(!r.top){t.getImageData(0,a,s,1).data.filter(h).length>0&&(r.top=Math.max(0,a-1))}if(!r.bottom){t.getImageData(0,n-a,s,1).data.filter(h).length>0&&(r.bottom=Math.min(n,a-1))}}let l=n-r.top-r.bottom,c=s-r.right-r.left,u=e||c,d=l,m=u*d/(c*l);return e&&(u=e,d=l*m),{bounds:r,scaleFactor:m,dims:{width:u,height:d},actualDims:{width:c,height:l}}}measure(t){const e=this.normalize(t);if(e in this.measureCache)return this.measureCache[e];const i=parseInt(t.fontSize||100,10),a=i+.5*i;this.measureCanvas.width=a,this.measureCanvas.height=a,this.measureContext.clearRect(0,0,a,a),this.measureContext.font=i+"px "+t.font,this.measureContext.textBaseline="middle",this.measureContext.textAlign="center",this.measureContext.fillText(t.emoji,.5*a,.5*a);let r=this.measureCanvasContextContent(this.measureContext,t.targetWidth,t.alphaThreshold),s=r.scaleFactor*i;return t.fontSize&&(s=t.fontSize),this.measureCache[e]={width:r.dims.width,height:r.dims.height,targetFontSize:s,yOffset:(.5*a-.5*r.actualDims.height-r.bounds.top)/r.actualDims.height,xOffset:(.5*a-.5*r.actualDims.width-r.bounds.left)/r.actualDims.width},this.measureCache[e]}render(t){t=this.normalizeInput(t);const e=this.normalize(t);if(e in this.canvasCache)return this.canvasCache[e];let i=document.createElement("canvas");const a=i.getContext("2d"),r=this.measure(t);i.setAttribute("width",r.width),i.setAttribute("height",r.height),a.clearRect(0,0,r.width,r.height),a.font=`${Math.round(r.targetFontSize)}px ${t.font}`,a.textAlign="center",a.textBaseline="middle";const s={x:.5*r.width+r.width*r.xOffset,y:.5*r.height+r.height*r.yOffset};return t.color&&(a.fillStyle=t.color),a.fillText(t.emoji,s.x,s.y),"BaseRenderer"===this.constructor.name&&(i=this.fillBackground(i,t.bgcolor)),this.canvasCache[e]=i,this.canvasCache[e]}fillBackground(t,e){if(!e||"transparent"===e||""===e)return t;const i=document.createElement("canvas"),a=i.getContext("2d"),r=t.getAttribute("width"),s=t.getAttribute("height");return i.setAttribute("width",r),i.setAttribute("height",s),a.beginPath(),a.fillStyle=e,a.fillRect(0,0,r,s),a.fill(),a.closePath(),a.drawImage(t,0,0),i}normalize(t){if((t=this.normalizeInput(t)).isError)return"PARSE_ERROR";let e=t.emoji+"_",i=[];for(const e in t)"emoji"!==e&&i.push([e,t[e]]);i.sort(((t,e)=>t[0]>e[0]?1:-1));for(const[t,a]of i){let t=String(a);[["true","t"],["false","f"],["null","n"],["sans-serif","ss"],["inside","is"],["outside","os"]].forEach((e=>t=t.replace(e[0],e[1])));for(let i=0;i<t.length;i++){const a=t.charCodeAt(i);e+=a>=48&&a<=57||a>=65&&a<=90||a>=61&&a<=122?t[i]:t.charCodeAt(i).toString(16)}}return e}normalizeInput(t){let e;if("object"==typeof t)e=t;else if("{"===t[0])try{e=JSON.parse(t)}catch(i){e={emoji:"�️",isBasicEmoji:!0,isError:!0},console.error("JSON PARSE failed on data-emoji='"+t+"'")}else e={isBasicEmoji:!0,emoji:t};e.targetWidth=e.targetWidth||this.options.targetWidth;for(const t in this.options)t in e||(e[t]=this.options[t]);return e}}{constructor(t={}){super({scale:1,rotate:null,crop:!0,...t})}render(t){if((t=this.normalizeInput(t)).isError)return super.render(t);const e=this.normalize(t);if(e in this.canvasCache)return this.canvasCache[e];const i=super.render(t),a=t.scale||1,r=parseInt(i.getAttribute("width"),10),s=parseInt(i.getAttribute("height"),10),n=r*a,o=s*a;let h=document.createElement("canvas"),l=h.getContext("2d");if(h.setAttribute("width",n),h.setAttribute("height",o),"rotate"in t){const e="string"==typeof t.rotate?parseFloat(t.rotate)*Math.PI/180:t.rotate,a={tl:{x:0,y:0},tr:{x:n,y:0},br:{x:n,y:o},bl:{x:0,y:o}},c={};for(const t in a){const i=.5*n,r=.5*o,s=a[t].x,h=a[t].y;c[t]={x:i+(s-i)*Math.cos(-e)+(h-r)*Math.sin(-e),y:r-(s-i)*Math.sin(-e)+(h-r)*Math.cos(-e)}}const u=Math.min(c.tl.x,c.tr.x,c.bl.x,c.br.x),d=Math.max(c.tl.x,c.tr.x,c.bl.x,c.br.x),m=Math.min(c.tl.y,c.tr.y,c.bl.y,c.br.y),g=n+(d-n)-u,f=o+(Math.max(c.tl.y,c.tr.y,c.bl.y,c.br.y)-o)-m;h.setAttribute("width",g),h.setAttribute("height",f),l.save(),l.translate(.5*g,.5*f),l.rotate(e),l.drawImage(i,0,0,r,s,-.5*n,-.5*o,n,o),l.restore()}else l.drawImage(i,0,0,r,s,0,0,n,o);return!0===t.crop&&(h=this.cropCanvas(h,t.targetWidth,t.alphaThreshold)),"TransformedRenderer"===this.constructor.name&&(h=this.fillBackground(h,t.bgcolor)),this.canvasCache[e]=h,this.canvasCache[e]}cropCanvas(t,e,i){const a=t.getContext("2d"),r=this.measureCanvasContextContent(a,e,i),s=document.createElement("canvas"),n=s.getContext("2d");return s.setAttribute("width",r.actualDims.width),s.setAttribute("height",r.actualDims.height),n.drawImage(t,r.bounds.left,r.bounds.top,r.actualDims.width,r.actualDims.height,0,0,r.actualDims.width,r.actualDims.height),s}}{constructor(t={}){super({pixelate:0,outline:0,outlineColor:"#ff0000",outlineMode:"inside",...t})}render(t){if((t=this.normalizeInput(t)).isError)return super.render(t);const e=this.normalize(t);if(e in this.canvasCache)return this.canvasCache[e];const i=super.render(t),a=0!==parseInt(t.pixelate)&&Math.round(t.pixelate),r=t.pixelate?a*t.outline:t.outline;let s=document.createElement("canvas"),n=s.getContext("2d");if(s.setAttribute("width",i.getAttribute("width")),s.setAttribute("height",i.getAttribute("height")),a>1){const e=document.createElement("canvas"),o=e.getContext("2d"),h=1/Math.round(a),l=parseInt(s.getAttribute("width"),10),c=parseInt(s.getAttribute("height"),10);let u=l*h,d=c*h,m=l,g=c;t.outline>0&&"inside"===t.outlineMode&&(u-=2*t.outline,d-=2*t.outline,g-=2*r,m-=2*r),n.imageSmoothingEnabled=!1,e.setAttribute("width",u),e.setAttribute("height",d),o.drawImage(i,0,0,l,c,0,0,u,d),n.clearRect(0,0,l,c),n.drawImage(e,0,0,u,d,0,0,m,g)}else s=i;if(t.outline){const e=document.createElement("canvas"),i=e.getContext("2d"),a=[-1,-1,0,-1,1,-1,-1,0,1,0,-1,1,0,1,1,1],n=parseInt(s.getAttribute("width"),10)+2*r,o=parseInt(s.getAttribute("height"),10)+2*r;e.setAttribute("width",n),e.setAttribute("height",o);for(let t=0;t<a.length;t+=2)i.drawImage(s,r+a[t]*r,r+a[t+1]*r);i.globalCompositeOperation="source-in",i.fillStyle=t.outlineColor,i.fillRect(0,0,n,o),i.globalCompositeOperation="source-over",i.drawImage(s,r,r),s=e}return t.crop&&(s=this.cropCanvas(s,t.targetWidth,t.alphaThreshold)),"DecoratedRenderer"===this.constructor.name&&(s=this.fillBackground(s,t.bgcolor)),this.canvasCache[e]=s,this.canvasCache[e]}},Object.defineProperty(t,"__esModule",{value:!0})}));